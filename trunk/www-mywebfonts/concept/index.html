
<!DOCTYPE html 
		PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<title>My Web Font</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="prototype.js"></script>

	<style type="text/css">
		#letters {
			background-color:		#ddd;
			padding:				0px;
			width:					400px;
		}


	</style>
	
	<script type="text/javascript">//<!--

		// Test for external request
		var EXTERNAL_SITE = "http://mywebfonts.appspot.com/concept";

		function initialize() {
			var script = new Element('script', { "type": "text/javascript", "src": EXTERNAL_SITE + "/javascriptDatas.js" });
			$$("head").first().appendChild(script);
		}

		/*
		 * It's bad and ugly code time
		 */
		function process(element, letterCoordinates) {
			var child;
			for (child = element.firstChild; child; child = child.nextSibling) {
				switch (child.nodeType) {
					case Node.TEXT_NODE:
						replaceText(child, element, letterCoordinates);
						break;
					case Node.ELEMENT_NODE:
						process(child, letterCoordinates);
						break;
				}
			}
		}

		function launchLetterReplacement(letterCoordinates) {

			$("debug").insert("Font Family : " + $("letters").style.fontFamily + "\n");
			$("debug").insert("Font Size : " + $("letters").style.fontSize + "\n");
			$("debug").insert("Font Weight : " + $("letters").style.fontWeight + "\n");
			//$("letters").style.backgroundColor = "red";
//$("debug").insert("Current color : " + $("letters").style.backgroundColor + "\n");

			var word = "Bonjour tous les enfants Test: ABCDEFGHIJKLMNOPQRSTUVWYZabcdefghijklmnopqrstuvwxyz!?,;:/\\_()[]\"'&# ";

			//var descendants = $("letters").descendants();

			process($("letters"), letterCoordinates);

			/*
			alert("Node value : " + $("letters").firstChild.nodeValue + " and nodeType " + $("letters").firstChild.nodeName);
			for (var descendantIndex = 0; descendantIndex < descendants.length; ++descendantIndex) {
				var descendant = descendants[descendantIndex];


				//alert("Descendant : " + descendant.firstChild.nodeValue + " and nodeType + " + descendant.nodeName);
				$("debug").update(descendant.inspect());
			}
			*/

			//$("debug").insert("Titi");
		}

		function replaceText(element, parent, letterCoordinates) {
			$("debug").insert("Titi : " + element.nodeValue + "\n");

			var letterImages = createTextImage(element, letterCoordinates);
			for (var index = 0; index < letterImages.length; ++index) {
				if (index == 0)
					parent.replaceChild(letterImages[index], element);
				else
					parent.insert(letterImages[index]);
				//$("debug").insert("Titi : " + letterImages[index] + "\n");
			}

		}

		function createTextImage(element, letterCoordinates) {
			var word = element.nodeValue;

			var letterImages = new Array();
			for (var index = 0; index < word.length; ++index) {
				var currentLetter = word[index];
				var letterCoordinate = letterCoordinates[currentLetter];
				if (letterCoordinate == null) {
					//TODO Could be better !
					//letterImages.push(new Element('span').update(currentLetter));
					continue;
				}

				var backgroundParameter = (-letterCoordinate.x) + "px " + (-letterCoordinate.y) + "px url(" + EXTERNAL_SITE + "/font-example.png)";

				var image = new Element('img', { src: EXTERNAL_SITE + "/transparent.png", alt: currentLetter });
				image.setStyle({
					background: 			backgroundParameter,
					width:					letterCoordinate.width + "px",
					height:					letterCoordinate.height + "px",
					padding:				"0px"/*,
					border:					"1px solid red",*/
				});

				letterImages.push(image);
			}

			return letterImages;
		}

		function loadPage() {
			initialize();
		}
		//-->
	</script>
</head>

<body onload="loadPage()">
	
	<div id="main">
		
		<h4>Welcome to the concept page of MyWebFonts</h4>
		It's a 33px * 48px.
		
		<h5>Content :</h5>

		<div id="letters" style="font-family : 'smf:bitstream'; font-size: 20px; font-weight: bold">
			Bonjour tous les enfants Test: ABCDEFGHIJKLMNOPQRSTUVWYZabcdefghijklmnopqrstuvwxyz!?,;:/\\_()[]\"'&# 
		</div>
		
		<h5>Original content :</h5>

		<div>
			<img src="icon.png" alt="Exit" /> 
			<span>Bonjour</span> tous <strong>les</strong> enfants Test: ABCDEFGHIJKLMNOPQRSTUVWYZabcdefghijklmnopqrstuvwxyz!?,;:/\\_()[]\"'&# 
		</div>

		<h5>Debugging :</h5>
		<textarea id="debug" cols="80" rows="8"></textarea>
	</div>

	
	<script type="text/javascript">
		var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
		document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
		try {
			var pageTracker = _gat._getTracker("UA-204102-4");
			pageTracker._trackPageview();
		} catch(err) {}
	</script>

</body>


</html>